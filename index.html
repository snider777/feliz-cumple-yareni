<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Feliz cumple Yareni ðŸŽ‰</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    let texts = [];
    let particles = [];
    let colors = ['#FF0000', '#FF00FF', '#FF66B2'];
    let explosionSound;
    let isMobile;

    function preload() {
      explosionSound = loadSound('explosion.mp3');
    }

    function setup() {
      isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      createCanvas(windowWidth, windowHeight);
      frameRate(60);
      textFont('Arial');
      textSize(32);
      textAlign(CENTER, CENTER);

      // Aumentamos la cantidad de frases
      let totalTexts = isMobile ? 30 : 50;
      for (let i = 0; i < totalTexts; i++) {
        texts.push(new FallingText(i, totalTexts));
      }
    }

    function draw() {
      background(0);
      let currentTime = millis();

      for (let t of texts) {
        if (t.waiting) {
          if (currentTime - t.timer >= t.delay) {
            t.reset();
            t.waiting = false;
          }
        } else {
          t.update();
        }
        t.show();
      }

      for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].show();
        if (particles[i].life <= 0) {
          particles.splice(i, 1);
        }
      }
    }

    function mousePressed() {
      explosionSound.play();
      let particleCount = isMobile ? 25 : 40;
      for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle(mouseX, mouseY));
      }

      for (let t of texts) {
        let d = dist(mouseX, mouseY, t.x, t.y);
        if (d < 100) {
          t.startDelay();  // Inicia el retardo antes de reaparecer
        }
      }
    }

    class FallingText {
      constructor(i, total) {
        this.index = i;
        this.total = total;
        this.reset(true);  // true para inicializar con separaciÃ³n vertical
        this.waiting = false;
      }

      reset(firstTime = false) {
        this.x = random(width);
        this.y = firstTime
          ? map(this.index, 0, this.total, -height * 2, -50)
          : random(-200, -50);
        this.speed = random(isMobile ? 4 : 2, isMobile ? 7 : 5);
        this.color = random(colors);
      }

      startDelay() {
        this.waiting = true;
        this.timer = millis();
        this.delay = random(300, 900); // entre 0.3s y 0.9s
      }

      update() {
        this.y += this.speed;
        if (this.y > height + 50) {
          this.startDelay();
        }
      }

      show() {
        fill(this.color);
        text("Feliz cumple", this.x, this.y);
        text("Yareni :D", this.x, this.y + 35); // segunda lÃ­nea un poco mÃ¡s abajo
      }
    }

    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        let angle = random(TWO_PI);
        let speed = random(2, 6);
        this.vx = cos(angle) * speed;
        this.vy = sin(angle) * speed;
        this.life = 50;
        this.color = random(colors);
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.2;
        this.life--;
      }

      show() {
        noStroke();
        fill(this.color);
        ellipse(this.x, this.y, 5);
      }
    }
  </script>
</body>
</html>
