<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Para Yareni</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      color: white;
    }
    #scrollContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow-y: auto;
      pointer-events: none;
    }
    #dedicatoria {
      padding: 40px;
      font-size: 20px;
      font-family: 'Arial';
      white-space: pre-wrap;
    }
    canvas {
      display: block;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.min.js"></script>
</head>
<body>
  <div id="scrollContainer">
    <div id="dedicatoria"></div>
  </div>
  <script>
    let frases = ["Hola Yareni :D", "Feliz cumpleaños"];
    let clickCount = 0;
    let fraseIndex = 0;
    let mensajeActual = frases[fraseIndex];
    let gotas = [];
    let explosiones = [];
    let mostrarDedicatoria = false;
    let mensajeFinalizado = false;

    let textoBase = "Hola Yareni ;) ... Que tal, espero que estés bien ... Hace unos meses que no nos vemos pero en fin, sé que no nos conocemos muy bien que digamos y solo hablamos un par de veces pero en ese poco tiempo me agradaste bastante de verdad ... Y bueno jajaja ... Espero te haya gustado el código que te hice :) ... Se te quiere Se te extraña ... Jajaja ... Bueno la verdad sí se te extraña, ojalá tener la oportunidad de conocernos más muy pronto ... Atte Caleb ... Por cierto hace mucho que no hacía una carta o algo de ese estilo ...";
    let textoVisible = "";
    let indexLetra = 0;
    let tiempoEscritura = 0;
    let velocidadEscritura = 100;
    let borrando = false;
    let borrarDesde = null;
    let borrarHasta = null;
    let esperando = false;
    let tiempoEspera = 0;
    let finalizado = false;
    let borrandoFinal = false;
    let coloresTexto = ["#ff8080", "#ff4da6", "#ff00ff"];

    let partesABorrar = [
      { texto: "Se te quiere", borrado: false },
      { texto: "Se te extraña", borrado: false }
    ];

    function setup() {
      createCanvas(windowWidth, windowHeight);
      textSize(26);
      textAlign(CENTER, CENTER);
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    function mousePressed() {
      if (!mostrarDedicatoria) {
        clickCount++;
        if (clickCount % 2 === 0) {
          fraseIndex = (fraseIndex + 1) % frases.length;
          mensajeActual = frases[fraseIndex];

          // Actualizar todas las gotas con el nuevo mensaje
          for (let g of gotas) {
            g.texto = mensajeActual;
          }
        }
        if (clickCount >= 30) {
          mostrarDedicatoria = true;
          document.getElementById("scrollContainer").style.pointerEvents = "auto";
        }

        // Crear explosión tipo fuegos artificiales
        let particulas = [];
        for (let i = 0; i < 30; i++) {
          particulas.push({
            x: mouseX,
            y: mouseY,
            angle: random(TWO_PI),
            speed: random(2, 6),
            alpha: 255,
            size: random(4, 8)
          });
        }
        explosiones.push(particulas);
      }
    }

    function draw() {
      background(0, 100);

      // Contador
      fill(255);
      textSize(20);
      textAlign(LEFT, TOP);
      text("Clics: " + clickCount, 20, 20);

      // Lluvia
      if (!mostrarDedicatoria) {
        textAlign(CENTER, CENTER);
        textSize(28);

        if (frameCount % 5 === 0) {
          let x = random(width);
          let y = -50;
          let speed = random(2, 6);
          gotas.push({ x, y, speed, alpha: 255, texto: mensajeActual });
        }

        for (let i = gotas.length - 1; i >= 0; i--) {
          let g = gotas[i];
          let txt = g.texto;
          let totalWidth = textWidth(txt);

          // Dibujar cada letra con color distinto
          let startX = g.x - totalWidth / 2;
          for (let j = 0; j < txt.length; j++) {
            let letra = txt[j];
            let color = random(coloresTexto);
            fill(color + hex(g.alpha, 2));
            text(letra, startX + textWidth(txt.slice(0, j)), g.y);
          }

          g.y += g.speed;
          g.alpha -= 1.5;
          if (g.alpha <= 0 || g.y > height + 50) {
            gotas.splice(i, 1);
          }
        }

        // Explosiones
        for (let e = explosiones.length - 1; e >= 0; e--) {
          let particulas = explosiones[e];
          for (let p of particulas) {
            let color = random(coloresTexto);
            fill(color + hex(p.alpha, 2));
            noStroke();
            ellipse(p.x, p.y, p.size);
            p.x += cos(p.angle) * p.speed;
            p.y += sin(p.angle) * p.speed;
            p.alpha -= 5;
          }
          if (particulas.every(p => p.alpha <= 0)) {
            explosiones.splice(e, 1);
          }
        }
      }

      // Dedicatoria
      if (mostrarDedicatoria && !borrandoFinal) {
        if (!borrando && !esperando && millis() - tiempoEscritura > velocidadEscritura && indexLetra < textoBase.length) {
          textoVisible += textoBase[indexLetra];
          indexLetra++;
          tiempoEscritura = millis();
        }

        for (let parte of partesABorrar) {
          if (!parte.borrado && textoVisible.includes(parte.texto)) {
            borrarDesde = textoVisible.lastIndexOf(parte.texto);
            borrarHasta = borrarDesde + parte.texto.length;
            esperando = true;
            tiempoEspera = millis();
            parte.borrado = true;
            break;
          }
        }

        if (esperando && millis() - tiempoEspera >= 3000) {
          borrando = true;
          esperando = false;
        }

        if (borrando && millis() - tiempoEscritura > velocidadEscritura) {
          textoVisible = textoVisible.slice(0, textoVisible.length - 1);
          tiempoEscritura = millis();
          if (textoVisible.length <= borrarDesde) {
            borrando = false;
          }
        }

        if (!borrando && indexLetra >= textoBase.length && !esperando && !mensajeFinalizado) {
          mensajeFinalizado = true;
          setTimeout(() => {
            borrandoFinal = true;
            indexLetra = textoVisible.length;
          }, 1000);
        }

        if (borrandoFinal && millis() - tiempoEscritura > velocidadEscritura) {
          textoVisible = textoVisible.substring(1);
          tiempoEscritura = millis();
        }

        let dedicatoriaHTML = "";
        for (let c of textoVisible) {
          let color = random(coloresTexto);
          dedicatoriaHTML += `<span style="color:${color}">${c}</span>`;
        }
        document.getElementById("dedicatoria").innerHTML = dedicatoriaHTML;
      }
    }
  </script>
</body>
</html>
