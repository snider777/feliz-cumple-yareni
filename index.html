<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Feliz cumple Yareni ðŸŽ‰</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    let texts = [];
    let particles = [];
    let colors = ['#FF0000', '#FF00FF', '#FF66B2'];
    let explosionSound;
    let isMobile;
    let lastTouchTime = 0;
    let showReminder = false;

    function preload() {
      explosionSound = loadSound('explosion.mp3');
    }

    function setup() {
      isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      createCanvas(windowWidth, windowHeight);
      frameRate(60);
      textFont('Arial');
      textSize(32);
      textAlign(CENTER, CENTER);

      let totalTexts = isMobile ? 40 : 60;
      for (let i = 0; i < totalTexts; i++) {
        texts.push(new FallingText(i, totalTexts));
      }

      lastTouchTime = millis();
    }

    function draw() {
      background(0);
      let currentTime = millis();

      // Mostrar mensaje de inactividad si pasaron 5 segundos
      showReminder = currentTime - lastTouchTime > 5000;

      for (let t of texts) {
        t.update();
        t.show();
      }

      for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].show();
        if (particles[i].life <= 0) {
          particles.splice(i, 1);
        }
      }

      if (showReminder) {
        fill(255);
        textSize(28);
        text("   Toca la pantalla\nquerida cumpleaÃ±era ;)", width / 2, height / 2);
        textSize(32); // restaurar
      }
    }

    function mousePressed() {
      lastTouchTime = millis(); // reiniciar temporizador
      explosionSound.play();
      let particleCount = isMobile ? 25 : 40;
      for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle(mouseX, mouseY));
      }

      for (let t of texts) {
        let d = dist(mouseX, mouseY, t.x, t.y);
        if (d < 100) {
          t.startDelay();  // solo retrasa la regeneraciÃ³n
        }
      }
    }

    class FallingText {
      constructor(i, total) {
        this.index = i;
        this.total = total;
        this.reset(true);
        this.waiting = false;
      }

      reset(firstTime = false) {
        this.x = random(width);
        this.y = firstTime
          ? map(this.index, 0, this.total, -height * 2, -50)
          : random(-300, -50);
        this.speed = random(isMobile ? 5 : 3, isMobile ? 10 : 7); // mÃ¡s rÃ¡pido
        this.color = random(colors);
        this.waiting = false;
      }

      startDelay() {
        this.waiting = true;
        this.timer = millis();
        this.delay = random(300, 900); // 0.3 a 0.9 s
      }

      update() {
        this.y += this.speed;

        if (this.y > height + 50 && !this.waiting) {
          this.startDelay();
        }

        if (this.waiting && millis() - this.timer >= this.delay) {
          this.reset();
        }
      }

      show() {
        fill(this.color);
        text("Feliz cumple", this.x, this.y);
        text("Yareni :D", this.x, this.y + 35);
      }
    }

    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        let angle = random(TWO_PI);
        let speed = random(2, 6);
        this.vx = cos(angle) * speed;
        this.vy = sin(angle) * speed;
        this.life = 50;
        this.color = random(colors);
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.2;
        this.life--;
      }

      show() {
        noStroke();
        fill(this.color);
        ellipse(this.x, this.y, 5);
      }
    }
  </script>
</body>
</html>
