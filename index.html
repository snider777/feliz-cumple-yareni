<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Para Yareni</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      color: white;
    }
    #scrollContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow-y: auto;
      pointer-events: none;
    }
    #dedicatoria {
      padding: 40px;
      font-size: 20px;
      font-family: 'Poppins', sans-serif;
      white-space: pre-wrap;
    }
    canvas {
      display: block;
    }
  </style>
  <!-- Fuente Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/p5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.7.0/lib/addons/p5.sound.min.js"></script>
</head>
<body>
  <div id="scrollContainer">
    <div id="dedicatoria"></div>
  </div>
  <script>
    let frases = ["Hola Yareni :)", "Feliz cumpleaños"];
    let gotas = [];
    let clickCount = 0;
    let mensajeActual = frases[0];
    let mostrarDedicatoria = false;
    let mensajeFinalizado = false;
    let indexLetra = 0;
    let textoVisible = "";
    let textoBase = "Hola Yareni ;) ... Que tal, espero que estés bien ... Hace unos meses que no nos vemos pero en fin, sé que no nos conocemos muy bien que digamos y solo hablamos un par de veces pero en ese poco tiempo me agradaste bastante de verdad ... Y bueno jajaja ... Espero te haya gustado el código que te hice :) ... Se te quiere Se te extraña ... Jajaja ... Bueno la verdad sí se te extraña, ojalá tener la oportunidad de conocernos más muy pronto ... Atte Caleb ... Por cierto hace mucho que no hacía una carta o algo de ese estilo ...";
    let partesABorrar = [
      { texto: "Se te quiere", borrado: false },
      { texto: "Se te extraña", borrado: false }
    ];
    let borrando = false, borrandoFinal = false, esperando = false;
    let borrarDesde = null, borrarHasta = null;
    let tiempoEscritura = 0;
    let velocidadEscritura = 100;
    let tiempoEspera = 0;
    let coloresTexto = ["#ff8080", "#ff4da6", "#ff00ff"];
    let fuenteMusical;
    let sonidoFondo;

    function preload() {
      sonidoFondo = loadSound("A-ha - Take On Me (Acoustic)  Subtitulada al Español.mp3");
    }

    function setup() {
      createCanvas(windowWidth, windowHeight);
      textSize(28);
      textAlign(CENTER, CENTER);
      textFont('Poppins');

      // Música
      if (sonidoFondo) {
        sonidoFondo.setVolume(0.4);
        sonidoFondo.loop();
      }
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    function mousePressed() {
      clickCount++;
      fraseIndex = (clickCount % frases.length);
      mensajeActual = frases[fraseIndex];

      // Cambiar todas las gotas activas al nuevo mensaje
      for (let g of gotas) {
        g.texto = mensajeActual;
      }

      if (clickCount >= 30) {
        mostrarDedicatoria = true;
        document.getElementById("scrollContainer").style.pointerEvents = "auto";
      }
    }

    function draw() {
      background(0, 100);

      fill(255);
      textSize(20);
      textAlign(LEFT, TOP);
      text("Clics: " + clickCount, 20, 20);

      if (!mostrarDedicatoria) {
        textSize(28);
        textAlign(CENTER, CENTER);

        if (frameCount % 5 === 0) {
          let x = random(width);
          let y = -50;
          let speed = random(2, 5);
          let color = random(coloresTexto);
          gotas.push({ x, y, speed, texto: mensajeActual, color });
        }

        for (let i = gotas.length - 1; i >= 0; i--) {
          let g = gotas[i];
          fill(g.color);
          text(g.texto, g.x, g.y);
          g.y += g.speed;
          if (g.y > height + 50) gotas.splice(i, 1);
        }
      }

      if (mostrarDedicatoria && !borrandoFinal) {
        if (!borrando && !esperando && millis() - tiempoEscritura > velocidadEscritura && indexLetra < textoBase.length) {
          textoVisible += textoBase[indexLetra];
          indexLetra++;
          tiempoEscritura = millis();

          if (textoVisible.endsWith(",") || textoVisible.endsWith("...")) {
            tiempoEscritura += 1000;
          }
        }

        for (let parte of partesABorrar) {
          if (!parte.borrado && textoVisible.includes(parte.texto)) {
            borrarDesde = textoVisible.lastIndexOf(parte.texto);
            borrarHasta = borrarDesde + parte.texto.length;
            esperando = true;
            tiempoEspera = millis();
            parte.borrado = true;
            break;
          }
        }

        if (esperando && millis() - tiempoEspera >= 1300) {
          borrando = true;
          esperando = false;
        }

        if (borrando && millis() - tiempoEscritura > velocidadEscritura) {
          textoVisible = textoVisible.slice(0, textoVisible.length - 1);
          tiempoEscritura = millis();
          if (textoVisible.length <= borrarDesde) {
            borrando = false;
          }
        }

        if (!borrando && indexLetra >= textoBase.length && !esperando && !mensajeFinalizado) {
          mensajeFinalizado = true;
          setTimeout(() => {
            borrandoFinal = true;
            indexLetra = textoVisible.length;
          }, 1000);
        }

        if (borrandoFinal && millis() - tiempoEscritura > velocidadEscritura) {
          textoVisible = textoVisible.substring(1);
          tiempoEscritura = millis();
        }

        let dedicatoriaHTML = "";
        for (let c of textoVisible) {
          let color = random(coloresTexto);
          dedicatoriaHTML += `<span style="color:${color}">${c}</span>`;
        }
        document.getElementById("dedicatoria").innerHTML = dedicatoriaHTML;
      }
    }
  </script>
</body>
</html>
