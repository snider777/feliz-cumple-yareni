<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Feliz cumple Yareni ðŸŽ‰</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.6.0/addons/p5.sound.min.js"></script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <script>
    let texts = [];
    let particles = [];
    let brillos = [];
    let colors = ['#FF0000', '#FF66B2', '#FFFFFF'];
    let explosionSound;
    let isMobile;
    let lastTouchTime = 0;
    let showReminder = false;
    let clickCount = 0;
    let maxClicks = 40;
    let modoDedicatoria = false;

    let dedicatoria = [
      "Hola Yareni ;) ... Que tal, espero que est\u00e9s bien ...",
      "Hace unos meses que no nos vemos pero en fin,",
      "s\u00e9 que no nos conocemos muy bien que digamos y solo hablamos un par de veces",
      "pero en ese poco tiempo me agradaste bastante de verdad ...",
      "Y bueno jajaja ... Espero te haya gustado el c\u00f3digo que te hice :) ...",
      "Se te quiere",
      "Se te extra\u00f1a",
      "Jajaja ... Bueno la verdad s\u00ed se te extra\u00f1a,",
      "ojal\u00e1 tener la oportunidad de conocernos m\u00e1s muy pronto ...",
      "Atte Caleb ...",
      "Por cierto hace mucho que no escrib\u00eda una carta"
    ];

    let typingIndex = 0;
    let lineIndex = 0;
    let currentLine = "";
    let typingDelay = 10;
    let frameCounter = 0;
    let borrando = false;
    let brilloCount = 40;

    function preload() {
      explosionSound = loadSound('explosion.mp3');
    }

    function setup() {
      isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      createCanvas(windowWidth, windowHeight);
      frameRate(60);
      textFont('Arial');
      textSize(32);
      textAlign(CENTER, CENTER);

      let totalTexts = isMobile ? 40 : 60;
      for (let i = 0; i < totalTexts; i++) {
        texts.push(new FallingText(i, totalTexts));
      }
      for (let i = 0; i < brilloCount; i++) {
        brillos.push(new Brillo());
      }
      lastTouchTime = millis();
    }

    function draw() {
      background(0);

      if (modoDedicatoria) {
        for (let b of brillos) {
          b.update();
          b.show();
        }
        drawDedicatoria();
        return;
      }

      let currentTime = millis();
      showReminder = currentTime - lastTouchTime > 5000;

      for (let t of texts) {
        t.update();
        t.show();
      }

      for (let i = particles.length - 1; i >= 0; i--) {
        particles[i].update();
        particles[i].show();
        if (particles[i].life <= 0) {
          particles.splice(i, 1);
        }
      }

      fill(255);
      textSize(20);
      text(`Taps: ${clickCount} / ${maxClicks}`, width - 100, 30);

      if (showReminder) {
        textSize(28);
        textAlign(CENTER, CENTER);
        textLeading(36);
        text("Toca la pantalla\nquerida cumplea\u00f1era ;)\n\n", width / 2, height / 2);
        textSize(32);
      }
    }

    function mousePressed() {
      if (modoDedicatoria) return;
      lastTouchTime = millis();
      explosionSound.play();
      clickCount++;

      if (clickCount >= maxClicks) {
        modoDedicatoria = true;
        texts = []; // detener frases
        return;
      }

      let particleCount = isMobile ? 25 : 40;
      for (let i = 0; i < particleCount; i++) {
        particles.push(new Particle(mouseX, mouseY));
      }

      for (let t of texts) {
        let d = dist(mouseX, mouseY, t.x, t.y);
        if (d < 100) {
          t.startDelay();
        }
      }
    }

    function drawDedicatoria() {
      fill(255);
      textAlign(CENTER, CENTER);
      textSize(26);
      frameCounter++;

      if (frameCounter % typingDelay === 0) {
        if (!borrando && typingIndex <= dedicatoria[lineIndex].length) {
          currentLine = dedicatoria[lineIndex].substring(0, typingIndex);
          typingIndex++;
        } else if (borrando && typingIndex >= 0) {
          currentLine = dedicatoria[lineIndex].substring(0, typingIndex);
          typingIndex--;
        } else {
          if (dedicatoria[lineIndex] === "Se te quiere" || dedicatoria[lineIndex] === "Se te extra\u00f1a" || dedicatoria[lineIndex] === "Por cierto hace mucho que no escrib\u00eda una carta") {
            borrando = !borrando;
            if (!borrando) {
              lineIndex++;
              typingIndex = 0;
            }
          } else {
            lineIndex++;
            typingIndex = 0;
          }
        }
      }

      if (lineIndex < dedicatoria.length) {
        let fullText = "";
for (let i = 0; i < lineIndex; i++) {
  fullText += dedicatoria[i] + "\\n";
}
fullText += currentLine;
text(fullText, width / 2, height / 2);
      }
    }

    class FallingText {
      constructor(i, total) {
        this.index = i;
        this.total = total;
        this.reset(true);
        this.waiting = false;
      }

      reset(firstTime = false) {
        this.x = random(width);
        this.y = firstTime ? map(this.index, 0, this.total, -height * 2, -50) : random(-300, -50);
        this.speed = random(isMobile ? 5 : 3, isMobile ? 10 : 7);
        this.color = random(colors);
        this.waiting = false;
      }

      startDelay() {
        this.waiting = true;
        this.timer = millis();
        this.delay = random(300, 900);
      }

      update() {
        this.y += this.speed;
        if (this.y > height + 50 && !this.waiting) {
          this.startDelay();
        }
        if (this.waiting && millis() - this.timer >= this.delay) {
          this.reset();
        }
      }

      show() {
        fill(this.color);
        text("Feliz cumple", this.x, this.y);
        text("Yareni :D", this.x, this.y + 35);
      }
    }

    class Particle {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        let angle = random(TWO_PI);
        let speed = random(2, 6);
        this.vx = cos(angle) * speed;
        this.vy = sin(angle) * speed;
        this.life = 50;
        this.color = random(colors);
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += 0.2;
        this.life--;
      }

      show() {
        noStroke();
        fill(this.color);
        ellipse(this.x, this.y, 5);
      }
    }

    class Brillo {
      constructor() {
        this.reset();
      }

      reset() {
        this.x = random(width);
        this.y = random(height);
        this.size = random(2, 5);
        this.speed = random(0.2, 0.5);
        this.color = random(colors);
        this.alpha = random(50, 150);
      }

      update() {
        this.y -= this.speed;
        if (this.y < 0) {
          this.reset();
          this.y = height;
        }
      }

      show() {
        noStroke();
        fill(color(this.color + hex(this.alpha, 2)));
        ellipse(this.x, this.y, this.size);
      }
    }
  </script>
</body>
</html>
